<!doctype html>
<html lang="so">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Labis Laundary — Receipt / Invoice</title>
<style>
  :root{--bg:#f7fafc;--card:#fff;--muted:#6b7280;--accent:#111827;--green:#10b981;--yellow:#f59e0b;}
  body{font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial; background:var(--bg); color:#0f172a; margin:0; padding:24px; -webkit-print-color-adjust:exact;}
  .container{max-width:900px;margin:0 auto;}
  .card{background:var(--card); border-radius:12px; padding:18px; box-shadow:0 6px 18px rgba(2,6,23,0.06);}
  h1{margin:0;font-size:20px;}
  .muted{color:var(--muted); font-size:13px;}
  .grid{display:grid;gap:12px;}
  .row-2{grid-template-columns:1fr 320px;}
  label{display:block;font-size:12px;color:var(--muted); margin-bottom:6px;}
  input[type="text"], input[type="number"], input[type="date"], select{width:100%; padding:8px 10px; border-radius:8px; border:1px solid #e6e9ef; font-size:14px;}
  table{width:100%; border-collapse:collapse; margin-top:10px;}
  th,td{padding:8px 6px; text-align:left; font-size:14px; border-bottom:1px solid #f1f5f9;}
  th{text-align:left; font-weight:600; color:var(--muted); font-size:13px;}
  .text-right{text-align:right;}
  .tabular{font-variant-numeric:tabular-nums;}
  .controls{display:flex; gap:8px; flex-wrap:wrap;}
  button{background:var(--accent); color:#fff; border:none; padding:8px 12px; border-radius:8px; cursor:pointer;}
  button.ghost{background:transparent;color:var(--accent); border:1px solid #e6e9ef;}
  button.warn{background:var(--yellow); color:#1f2937;}
  .badge{display:inline-block;padding:6px 10px;border-radius:999px;font-weight:700;font-size:13px;}
  .paid{background:#ecfdf5;color: #065f46;border:1px solid rgba(16,185,129,0.12);}
  .unpaid{background:#fffbeb;color:#92400e;border:1px solid rgba(245,158,11,0.12);}
  .totals{display:flex; justify-content:flex-end; margin-top:12px;}
  .totals .box{width:320px; background:#fafafa; padding:12px; border-radius:8px; border:1px solid #f1f5f9;}
  .small{font-size:13px;color:var(--muted);}
  .no-print{display:block;}
  @media print{
    body{padding:0;}
    .no-print{display:none !important;}
    .card{box-shadow:none;border-radius:0;}
  }
  /* small helpers */
  .inline{display:inline-block}
  .flex{display:flex;gap:8px;align-items:center}
  .right{margin-left:auto}
  .danger{background:#fee2e2;color:#991b1b;border:1px solid rgba(220,38,38,0.08)}
  .small-input{width:110px}
</style>
</head>
<body>
  <div class="container">
    <div class="card">
      <div style="display:flex;gap:12px;align-items:center;justify-content:space-between;">
        <div>
          <h1 contenteditable="true" id="bizName">labis laundary</h1>
          <div class="muted" contenteditable="true" id="bizAddress">Cinwaan: --</div>
          <div class="muted" contenteditable="true" id="bizPhone">Tel: +2527xxxxxxx · info@example.com</div>
        </div>
        <div style="text-align:right">
          <div class="small">Invoice # <input id="invoiceNo" type="number" value="1" style="width:80px; padding:6px;border-radius:6px;border:1px solid #e6e9ef"></div>
          <div class="small" style="margin-top:6px">Taariikh: <input id="invoiceDate" type="date"></div>
          <div id="paidBadge" style="margin-top:10px"></div>
        </div>
      </div>

      <hr style="margin:12px 0;border:none;border-top:1px solid #f1f5f9">

      <div class="grid row-2">
        <div>
          <label>Macmiil (Magac)</label>
          <input id="custName" type="text" placeholder="Magaca Macmiilka">
          <label style="margin-top:8px">Telefoon</label>
          <input id="custPhone" type="text" placeholder="Tel Macmiilka">
        </div>

        <div>
          <label>Xaaladda Bixinta</label>
          <div class="flex">
            <label class="inline"><input type="radio" name="paidState" value="paid" id="paidYes"> <strong>Paid</strong></label>
            <label class="inline"><input type="radio" name="paidState" value="unpaid" id="paidNo" checked> <strong>Unpaid</strong></label>
            <div class="right small muted">Dooro ka dibna daabac</div>
          </div>

          <label style="margin-top:8px">Lacag (Currency)</label>
          <select id="currency">
            <option value="ETB">ETB (Br)</option>
            <option value="USD">USD ($)</option>
            <option value="EUR">EUR (€)</option>
          </select>
        </div>
      </div>

      <div style="margin-top:14px">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div><strong>Alaabooyinka (Laundry)</strong></div>
          <div class="no-print flex">
            <select id="quickAdd">
              <option value="">+ Ku dar shay degdeg...</option>
              <option value="Shaadh">Shaadh (Shirt)</option>
              <option value="Garan">Garan (Jacket)</option>
              <option value="Surwal">Surwal (Pants)</option>
              <option value="Macawis">Macawis (Dress)</option>
              <option value="Suudh">Suudh (Suit)</option>
            </select>
            <button class="ghost" id="addCustom">+ Custom</button>
            <button class="ghost" id="resetBtn">Invoice Cusub</button>
          </div>
        </div>

        <table id="itemsTable" aria-label="items">
          <thead>
            <tr>
              <th style="width:160px">Nooca / Item</th>
              <th>Sharaxaad</th>
              <th style="width:90px" class="text-right">Tiro</th>
              <th style="width:120px" class="text-right">Qiime</th>
              <th style="width:120px" class="text-right">Wadarta</th>
              <th class="no-print" style="width:70px"></th>
            </tr>
          </thead>
          <tbody id="itemsBody">
            <!-- rows injected by JS -->
          </tbody>
        </table>
      </div>

      <div style="margin-top:12px;display:flex;gap:12px;align-items:center;justify-content:space-between">
        <div class="small muted">Canshuur % <input id="taxRate" type="number" class="small-input" min="0" step="0.01" value="0"> &nbsp; Dhimis (lacag) <input id="discount" type="number" class="small-input" min="0" step="0.01" value="0"></div>
        <div class="controls no-print">
          <button id="printBtn">Daabac / PDF</button>
          <button id="exportJson" class="ghost">Export JSON</button>
          <button id="clearStorage" class="danger">Tirtir Xogta</button>
        </div>
      </div>

      <div class="totals">
        <div class="box">
          <div style="display:flex;justify-content:space-between"><div class="small">Isku-geyn</div><div class="tabular" id="subtotal">Br 0.00</div></div>
          <div style="display:flex;justify-content:space-between;margin-top:6px"><div class="small">Canshuur</div><div class="tabular" id="taxAmount">Br 0.00</div></div>
          <div style="display:flex;justify-content:space-between;margin-top:6px"><div class="small">Dhimis</div><div class="tabular" id="discountAmount">Br 0.00</div></div>
          <hr style="margin:8px 0;border:none;border-top:1px solid #f1f5f9">
          <div style="display:flex;justify-content:space-between"><div style="font-weight:700">Wadarta</div><div style="font-size:18px;font-weight:800" id="grandTotal">Br 0.00</div></div>
        </div>
      </div>

      <div style="margin-top:16px;border-top:1px dashed #eef2f7;padding-top:12px">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div class="small muted">TIN/VAT: <span contenteditable id="taxId">TIN/VAT</span></div>
          <div style="text-align:right">
            <div id="signature" class="muted small">Mahadsanid! — labis laundary</div>
          </div>
        </div>
      </div>

    </div>
  </div>

<script>
/*
  Simple single-file receipt/invoice for "labis laundary".
  - Uses localStorage key 'labis_receipt_v1'
  - Editable fields, add/remove items, print, export JSON
*/
(function(){
  const STORAGE = 'labis_receipt_v1';
  const currencySymbols = { ETB: 'Br', USD: '$', EUR: '€' };

  // elements
  const itemsBody = document.getElementById('itemsBody');
  const quickAdd = document.getElementById('quickAdd');
  const addCustom = document.getElementById('addCustom');
  const invoiceNo = document.getElementById('invoiceNo');
  const invoiceDate = document.getElementById('invoiceDate');
  const custName = document.getElementById('custName');
  const custPhone = document.getElementById('custPhone');
  const taxRate = document.getElementById('taxRate');
  const discount = document.getElementById('discount');
  const subtotalEl = document.getElementById('subtotal');
  const taxAmountEl = document.getElementById('taxAmount');
  const discountAmountEl = document.getElementById('discountAmount');
  const grandTotalEl = document.getElementById('grandTotal');
  const printBtn = document.getElementById('printBtn');
  const exportJson = document.getElementById('exportJson');
  const resetBtn = document.getElementById('resetBtn');
  const clearStorage = document.getElementById('clearStorage');
  const paidYes = document.getElementById('paidYes');
  const paidNo = document.getElementById('paidNo');
  const paidBadge = document.getElementById('paidBadge');
  const currencySelect = document.getElementById('currency');
  const bizName = document.getElementById('bizName');
  const bizAddress = document.getElementById('bizAddress');
  const bizPhone = document.getElementById('bizPhone');
  const taxId = document.getElementById('taxId');

  // state
  let state = {
    biz: { name: 'labis laundary', address:'Cinwaan: --', phone:'+2527xxxxxxx', taxId:'TIN/VAT'},
    invoiceNo: 1,
    invoiceDate: (new Date()).toISOString().slice(0,10),
    customer: { name:'', phone:'' },
    currency: 'ETB',
    items: [],
    taxRate: 0,
    discount: 0,
    isPaid: false
  };

  // helpers
  const uid = ()=> 'id'+Math.random().toString(36).slice(2,9);
  const money = (n)=> Number(n||0).toLocaleString(undefined,{minimumFractionDigits:2,maximumFractionDigits:2});

  // load/save
  function load(){
    const raw = localStorage.getItem(STORAGE);
    if(raw){
      try{ Object.assign(state, JSON.parse(raw)); }catch(e){ console.warn('load err',e); }
    }
    // init defaults if no items
    if(!state.items || state.items.length===0){
      state.items = [{ id:uid(), type:'Shaadh', name:'Shaadh', qty:1, price:0 }];
    }
    renderAll();
  }
  function save(){
    localStorage.setItem(STORAGE, JSON.stringify(state));
  }

  // render rows
  function renderAll(){
    // header / fields
    bizName.innerText = state.biz.name || 'labis laundary';
    bizAddress.innerText = state.biz.address || '';
    bizPhone.innerText = state.biz.phone || '';
    taxId.innerText = state.biz.taxId || '';
    invoiceNo.value = state.invoiceNo;
    invoiceDate.value = state.invoiceDate;
    custName.value = state.customer.name || '';
    custPhone.value = state.customer.phone || '';
    currencySelect.value = state.currency || 'ETB';
    taxRate.value = state.taxRate || 0;
    discount.value = state.discount || 0;
    paidYes.checked = state.isPaid === true;
    paidNo.checked = state.isPaid === false;

    // paid badge
    renderBadge();

    // table
    itemsBody.innerHTML = '';
    state.items.forEach((it, index) => {
      const tr = document.createElement('tr');

      // type
      const tdType = document.createElement('td');
      const sel = document.createElement('select');
      ['Shaadh','Garan','Surwal','Macawis','Suudh','Custom'].forEach(opt=>{
        const o = document.createElement('option'); o.value = opt; o.innerText = opt; if(opt===it.type) o.selected = true; sel.appendChild(o);
      });
      sel.addEventListener('change', e=>{ it.type = e.target.value; it.name = e.target.value; save(); renderAll(); });
      tdType.appendChild(sel);

      // name/desc
      const tdName = document.createElement('td');
      const inName = document.createElement('input');
      inName.type='text'; inName.value = it.name || ''; inName.addEventListener('input', e=>{ it.name = e.target.value; save(); renderTotals(); });
      tdName.appendChild(inName);

      // qty
      const tdQty = document.createElement('td');
      tdQty.className='text-right';
      const inQty = document.createElement('input'); inQty.type='number'; inQty.min=0; inQty.value = it.qty; inQty.style.width='70px';
      inQty.addEventListener('input', e=>{ it.qty = Number(e.target.value||0); save(); renderTotals(); });
      tdQty.appendChild(inQty);

      // price
      const tdPrice = document.createElement('td');
      tdPrice.className='text-right';
      const inPrice = document.createElement('input'); inPrice.type='number'; inPrice.min=0; inPrice.step='0.01'; inPrice.value = it.price; inPrice.style.width='90px';
      inPrice.addEventListener('input', e=>{ it.price = Number(e.target.value||0); save(); renderTotals(); });
      tdPrice.appendChild(inPrice);

      // line total
      const tdLine = document.createElement('td');
      tdLine.className='text-right tabular';
      tdLine.innerText = currencySymbols[state.currency]+' '+ money( (it.qty||0)*(it.price||0) );

      // actions
      const tdAct = document.createElement('td'); tdAct.className='no-print';
      const del = document.createElement('button'); del.className='ghost'; del.innerText='Delete';
      del.addEventListener('click', ()=>{ state.items = state.items.filter(x=>x.id!==it.id); save(); renderAll(); });
      tdAct.appendChild(del);

      tr.append(tdType, tdName, tdQty, tdPrice, tdLine, tdAct);
      itemsBody.appendChild(tr);
    });

    renderTotals();
  }

  function renderTotals(){
    const subtotal = state.items.reduce((s,it)=> s + (Number(it.qty)||0)*(Number(it.price)||0), 0);
    const tax = subtotal * (Number(state.taxRate||0)/100);
    const discountAmt = Number(state.discount||0);
    const total = Math.max(0, subtotal + tax - discountAmt);
    const sym = currencySymbols[state.currency] || state.currency;

    subtotalEl.innerText = sym + ' ' + money(subtotal);
    taxAmountEl.innerText = sym + ' ' + money(tax);
    discountAmountEl.innerText = sym + ' ' + money(discountAmt);
    grandTotalEl.innerText = sym + ' ' + money(total);
  }

  function renderBadge(){
    paidBadge.innerHTML = '';
    const sp = document.createElement('span'); sp.className='badge ' + (state.isPaid ? 'paid' : 'unpaid');
    sp.innerText = state.isPaid ? 'PAID' : 'UNPAID';
    paidBadge.appendChild(sp);
  }

  // actions
  quickAdd.addEventListener('change', e=>{
    const v = e.target.value; if(!v) return;
    state.items.push({ id:uid(), type:v, name:v, qty:1, price:0 }); save(); renderAll(); e.target.value='';
  });

  addCustom.addEventListener('click', ()=> {
    const name = prompt('Geli magaca shayga (e.g. Tshirt / Bedding):','Custom item');
    if(name) { state.items.push({ id:uid(), type:'Custom', name, qty:1, price:0 }); save(); renderAll(); }
  });

  invoiceNo.addEventListener('change', ()=>{ state.invoiceNo = invoiceNo.value; save(); });
  invoiceDate.addEventListener('change', ()=>{ state.invoiceDate = invoiceDate.value; save(); });
  custName.addEventListener('input', ()=>{ state.customer.name = custName.value; save(); });
  custPhone.addEventListener('input', ()=>{ state.customer.phone = custPhone.value; save(); });
  taxRate.addEventListener('input', ()=>{ state.taxRate = Number(taxRate.value||0); save(); renderTotals(); });
  discount.addEventListener('input', ()=>{ state.discount = Number(discount.value||0); save(); renderTotals(); });
  currencySelect.addEventListener('change', ()=>{ state.currency = currencySelect.value; save(); renderAll(); });

  paidYes.addEventListener('change', ()=>{ state.isPaid = true; save(); renderBadge(); });
  paidNo.addEventListener('change', ()=>{ state.isPaid = false; save(); renderBadge(); });

  printBtn.addEventListener('click', ()=>{ window.print(); });
  exportJson.addEventListener('click', ()=>{
    const data = JSON.stringify(state, null, 2);
    const blob = new Blob([data], { type:'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url; a.download = `invoice-${state.invoiceNo||'0'}.json`; a.click();
    URL.revokeObjectURL(url);
  });

  resetBtn.addEventListener('click', ()=>{
    if(!confirm('Invoice cusub — xog hore waa la kordhin doonaa? Haa sii wad.')) return;
    state.invoiceNo = Number(state.invoiceNo||0) + 1;
    state.items = [{ id:uid(), type:'Shaadh', name:'Shaadh', qty:1, price:0 }];
    state.customer = { name:'', phone:'' };
    state.taxRate = 0; state.discount = 0; state.isPaid = false;
    save(); renderAll();
  });

  clearStorage.addEventListener('click', ()=>{
    if(confirm('Ma hubtaa inaad tirtirayso xogta localStorage?')) { localStorage.removeItem(STORAGE); location.reload(); }
  });

  // editable biz fields save
  bizName.addEventListener('input', ()=>{ state.biz.name = bizName.innerText; save(); });
  bizAddress.addEventListener('input', ()=>{ state.biz.address = bizAddress.innerText; save(); });
  bizPhone.addEventListener('input', ()=>{ state.biz.phone = bizPhone.innerText; save(); });
  taxId.addEventListener('input', ()=>{ state.biz.taxId = taxId.innerText; save(); });

  // initial load: set date default to today if empty
  document.addEventListener('DOMContentLoaded', ()=>{
    load();
    if(!state.invoiceDate) { state.invoiceDate = (new Date()).toISOString().slice(0,10); invoiceDate.value = state.invoiceDate; save(); }
  });

})();
</script>
</body>
</html>
